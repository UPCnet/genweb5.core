<html
    xmlns="http://www.w3.org/1999/xhtml"
    xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="plone">
  <body>

    <metal:custom_title
        fill-slot="content-title"
        tal:define="header view/header_string">

      <tal:comment tal:replace="nothing">

        Sustituimos el título de la página por el subtítulo en caso de que tenga este segundo.
        Quitamos el nav donde se mostraban los botones de iCal, etc.

      </tal:comment>

      <h1 class="documentFirstHeading">

        <span
            tal:replace="header/sub"
            tal:condition="header/sub" />

        <tal:condition condition="not: header/sub">

          <span
              tal:replace="header/main"
              tal:condition="header/main" />

        </tal:condition>

      </h1>

    </metal:custom_title>

    <metal:content-core fill-slot="content-core">
      <metal:block define-macro="content-core">
        <tal:def define="batch view/events;
                 toLocalizedTime nocall: context/@@plone/toLocalizedTime;">

          <tal:listing condition="python:batch">
            <div class="entries" metal:define-slot="entries"
                tal:define="portal python:portal_state.portal();
                            image_scale portal/@@image_scale">

              <tal:repeat repeat="item python:batch" metal:define-macro="entries">

                <tal:block tal:define="obj item
                    item_url python:item.getURL();
                    item_id python:item.getId();
                    item_title python:item.Title();
                    item_title python:item_title or item_id;
                    item_description python:item.Description();
                    item_type python:item.PortalType();
                    item_modified python:item.ModificationDate();
                    item_created python:item.CreationDate();
                    item_wf_state python:item.review_state();
                    item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
                    item_creator python:item.Creator();
                    item_link python:item_type in view.use_view_action and item_url+'/view' or item_url;
                    item_is_event python:view.is_event(obj);
                    item_has_image python:item.getIcon;
                    item_type_class python:('contenttype-' + view.normalizeString(item_type)) if showicons else '' ;
                    ">
                  <metal:block define-slot="entry">

                    <article class="mb-3 row">

                      <div class="col" metal:define-macro="listitem">

                          <div class="mb-1">
                            <a tal:attributes="href python:item_link; class string:$item_type_class $item_wf_state_class url; title item_type" tal:content="python:item_title">
                              Item Title
                            </a>
                          </div>

                          <metal:block metal:define-macro="document_byline">
                          <div class="mb-1">

                            <tal:event condition="python:item_is_event">
                              <tal:date tal:replace="structure python:view.formatted_date(obj)"/>
                              <span tal:condition="python:obj.location" i18n:translate="label_event_byline_location">
                                &mdash;
                                <span tal:content="python:obj.location" class="location" i18n:name="location">Oslo</span>
                              </span>
                              &mdash;
                            </tal:event>

                            <tal:byline condition="python:view.show_about">
                              <tal:name tal:condition="python:item_creator"
                                  tal:define="author python:view.pas_member.info(item_creator);
                                              creator_short_form python:author.get('username');
                                              creator_long_form string:?author=$${python:author.username};
                                              creator_is_openid python:'/' in creator_short_form;
                                              creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];">
                              <span i18n:translate="label_by_author">
                                by
                                <a tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
                                    tal:content="python: author.get('name_or_id')"
                                    tal:omit-tag="python: not author"
                                    i18n:name="author">
                                  Bob Dobalina
                                </a>
                              </span>
                              </tal:name>

                              <metal:description define-slot="description_slot">
                                <tal:comment replace="nothing">
                                  Place custom listing info for custom types here
                                </tal:comment>
                              </metal:description>

                            </tal:byline>
                          </div>
                          </metal:block>

                          <p class="me-3" tal:condition="python:item_description" tal:content="python:item_description">
                            description
                          </p>
                      </div>

                      <div class="col-3 text-end" tal:condition="item_has_image">
                        <a tal:attributes="href python:item_link;">

                          <tal:comment replace="nothing">
                            Cambiar tamaño de la imagen a preview, se cargaba con thumb
                          </tal:comment>

                          <img class="image-responsive"
                               tal:attributes="src string:${item_link}/@@images/image/preview;
                                               title item_title;
                                               alt item_title;" />
                        </a>
                      </div>
                    </article>

                  </metal:block>
                </tal:block>
              </tal:repeat>
            </div>

            <div metal:use-macro="context/batch_macros/macros/navigation" />

          </tal:listing>

        </tal:def>
      </metal:block>
    </metal:content-core>

  </body>
</html>
