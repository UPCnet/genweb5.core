<html
    xmlns="http://www.w3.org/1999/xhtml"
    xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="plone">
  <body>

    <metal:custom_title
        fill-slot="content-title"
        tal:define="header view/header_string">

      <tal:comment tal:replace="nothing">

        Sustituimos el título de la página por el subtítulo en caso de que tenga este segundo.
        Quitamos el nav donde se mostraban los botones de iCal, etc.

      </tal:comment>

      <h1 class="documentFirstHeading">

        <span
            tal:replace="header/sub"
            tal:condition="header/sub" />

        <tal:condition condition="not: header/sub">

          <span
              tal:replace="header/main"
              tal:condition="header/main" />

        </tal:condition>

      </h1>

    </metal:custom_title>

    <metal:content-core fill-slot="content-core">
      <metal:block define-macro="content-core">
        <tal:def define="batch view/events;
                 toLocalizedTime nocall: context/@@plone/toLocalizedTime;">

          <section>

            <tal:items repeat="data batch">

              <tal:repeat repeat="item python:batch" metal:define-macro="entries">
                <tal:block tal:define="item_url item/url;
                    item_title item/title;
                    item_description item/description;
                    item_type python:item.context.portal_type;
                    item_creator python:item.context.Creator();
                    item_link python:item_url+'/view';
                    item_has_image python:item.context.getIcon();
                    ">
                  <metal:block define-slot="entry">

                    <article class="mb-3 row">

                      <div class="col" metal:define-macro="listitem">

                          <div class="mb-1">
                            <a class="contenttype-event url" tal:attributes="href python:item_link; title item_type" tal:content="python:item_title">
                              Item Title
                            </a>
                          </div>

                          <metal:block metal:define-macro="document_byline">
                          <div class="mb-1">

                            <tal:date tal:replace="structure python:view.formatted_date(item.context)"/>
                            <span tal:condition="item/context/location" i18n:translate="label_event_byline_location">
                              &mdash;
                              <span tal:content="item/context/location" class="location" i18n:name="location">Oslo</span>
                            </span>

                          </div>
                          </metal:block>

                          <p class="me-3" tal:condition="python:item_description" tal:content="python:item_description">
                            description
                          </p>
                      </div>

                      <div class="col-3 text-end" tal:condition="item_has_image">
                        <a tal:attributes="href python:item_link;">

                          <tal:comment replace="nothing">
                            Cambiar tamaño de la imagen a preview, se cargaba con thumb
                          </tal:comment>

                          <img class="image-responsive"
                               tal:attributes="src string:${item_url}/@@images/image/preview;
                                               title item_title;
                                               alt item_title;" />
                        </a>
                      </div>
                    </article>

                  </metal:block>
                </tal:block>
              </tal:repeat>

            </tal:items>

          </section>

          <div metal:use-macro="context/batch_macros/macros/navigation" />

        </tal:def>
      </metal:block>
    </metal:content-core>

  </body>
</html>
